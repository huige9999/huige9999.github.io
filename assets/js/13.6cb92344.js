(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{438:function(s,a,n){s.exports=n.p+"assets/img/28.cdd2f77c.png"},439:function(s,a,n){s.exports=n.p+"assets/img/29.6c48f589.png"},440:function(s,a,n){s.exports=n.p+"assets/img/30.cfce488d.png"},510:function(s,a,n){"use strict";n.r(a);var e=n(2),t=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"拖拽-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拖拽-api"}},[s._v("#")]),s._v(" 拖拽 API")]),s._v(" "),a("h3",{attrs:{id:"研究对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#研究对象"}},[s._v("#")]),s._v(" 研究对象")]),s._v(" "),a("ul",[a("li",[s._v("拖拽元素\n普通元素设置 draggable 属性为 true")]),s._v(" "),a("li",[s._v("拖放区域")])]),s._v(" "),a("p",[a("img",{attrs:{src:n(438),alt:"alt text"}})]),s._v(" "),a("h3",{attrs:{id:"事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件"}},[s._v("#")]),s._v(" 事件")]),s._v(" "),a("p",[a("strong",[s._v("拖拽元素相关事件")]),s._v("\ndragstart: 开始拖拽\ndrag: 拖拽过程中\ndragend: 拖拽结束")]),s._v(" "),a("p",[a("strong",[s._v("拖放区域相关事件")]),s._v("\ndragenter: 拖拽元素进入区域\ndragover: 拖拽元素在区域内移动\ndragleave: 拖拽元素离开区域\ndrop: 拖拽元素在区域内释放")]),s._v(" "),a("blockquote",[a("p",[s._v("补充 1：对于 dragover 事件，默认情况下元素是不允许其他元素在它上面移动的，需要取消默认行为")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('  拖放区域.addEventListener("dragover", (e) => {\n    e.preventDefault();\n  });\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("blockquote",[a("p",[s._v("补充 2：对于 drop 事件，默认情况下输入框能显示拖过来的文本或链接,也可以取消默认行为")])]),s._v(" "),a("h3",{attrs:{id:"实现拖拽元素移动到拖放区域内"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现拖拽元素移动到拖放区域内"}},[s._v("#")]),s._v(" 实现拖拽元素移动到拖放区域内")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('1. 拖放区域取消dropover默认行为\n\n2. 当拖拽元素在拖放区域内释放时，将拖拽元素放到拖放区域内\n\n拖放区域.addEventListener("drop", (e) => {\n    拖放区域.appendChild(拖拽元素);\n})\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"数据传递"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据传递"}},[s._v("#")]),s._v(" 数据传递")]),s._v(" "),a("p",[s._v("拖拽过程和拖放过程进行数据传递靠：dataTransfer 对象")]),s._v(" "),a("h4",{attrs:{id:"datatransfer-对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#datatransfer-对象"}},[s._v("#")]),s._v(" dataTransfer 对象")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("setData(format, data)")]),s._v(": 设置数据")]),s._v(" "),a("li",[a("strong",[s._v("getData(format)")]),s._v(": 获取数据")]),s._v(" "),a("li",[s._v("setDragImage(image, x, y): 设置拖拽图标(即：拖拽过程中跟随鼠标的半透明图片)")]),s._v(" "),a("li",[s._v("dropEffect: 设置拖放图标(即：拖放操作时类似鼠标光标反馈的效果)")])]),s._v(" "),a("h4",{attrs:{id:"将内容拖到拖放区域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将内容拖到拖放区域"}},[s._v("#")]),s._v(" 将内容拖到拖放区域")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('dragstart时：\n// 存文本数据\n dataTransfer.setData("text/plain", 内容);\n // 设置拖拽图标\n // 补充0,0表示图标相对鼠标的偏移\n dataTransfer.setDragImage(拖拽图标, 0, 0);\n\ndragover时：\n // 设置拖放图标\n dataTransfer.dropEffect = "copy";\n 取消默认行为\n\n drop时：\n // 获取文本数据\n var content = dataTransfer.getData("text/plain");\n 拖放区域.innerHTML = content;\n 拖放元素.remove();\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h3",{attrs:{id:"实现拖拽排序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现拖拽排序"}},[s._v("#")]),s._v(" 实现拖拽排序")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("dragstart时：\n 给拖拽元素加个半透明样式(可选)\n 暂存拖拽元素\n\ndragend时：\n 去除拖拽元素的半透明样式\n 释放暂存的拖拽元素\n\n dragover时：\n  判断、换位(插入操作实现换位)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("blockquote",[a("p",[s._v("dragstart 和 dragend 可以理解成生命周期中的初始化和结束")])]),s._v(" "),a("h4",{attrs:{id:"核心-判断、换位"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#核心-判断、换位"}},[s._v("#")]),s._v(" 核心：判断、换位")]),s._v(" "),a("p",[a("strong",[s._v("目标元素：被比较的元素，即：要和拖拽元素进行比较")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("if(目标元素不是拖拽元素自己 && 目标元素一定是LI元素) {\n  // 鼠标的y坐标减去目标元素的top坐标\n  const tHeight = 计算出鼠标在目标元素上的位置;\n  if(tHeight < 目标元素高度的一半) {\n    // insertBefore(拖拽元素, 目标元素)\n    拖拽元素插入到目标元素前面\n  } else {\n    // insertAfter(拖拽元素, 目标元素)\n    拖拽元素插入到目标元素后面\n  }\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[a("img",{attrs:{src:n(439),alt:"alt text"}})]),s._v(" "),a("h2",{attrs:{id:"fileapi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fileapi"}},[s._v("#")]),s._v(" FileAPI")]),s._v(" "),a("p",[s._v("FileAPI 使得用户可以在浏览器层面操作文件")]),s._v(" "),a("h3",{attrs:{id:"blob"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#blob"}},[s._v("#")]),s._v(" Blob")]),s._v(" "),a("h4",{attrs:{id:"相关概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关概念"}},[s._v("#")]),s._v(" 相关概念")]),s._v(" "),a("p",[s._v("File 的父类，拥有 File 的核心功能：存储某种"),a("strong",[s._v("类型")]),s._v("的"),a("strong",[s._v("数据")]),s._v("，可以是文本、图片、视频、音频等")]),s._v(" "),a("blockquote",[a("p",[s._v("注意：Blob 对象只能在内存中使用，不能直接操作文件")]),s._v(" "),a("blockquote",[a("p",[s._v("Blob 对象中的数据只能读取，不能更改")])])]),s._v(" "),a("h4",{attrs:{id:"使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// 这个操作相当于在内存中创建了一个txt文件\n  const blob = new Blob(["hello world"], { type: "text/plain" });\n // 对blob中的数据进行切割并放到新的blob中(以字节为单位)\n  const firBlob = blob.slice(0, 3)\n\n  // 读取blob中的数据\n  blob.arrayBuffer().then((res) => console.log(res))\n  blob.text().then((res) => console.log(res))\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#file"}},[s._v("#")]),s._v(" File")]),s._v(" "),a("h4",{attrs:{id:"相关概念-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关概念-2"}},[s._v("#")]),s._v(" 相关概念")]),s._v(" "),a("p",[s._v("File 继承自 Blob，在 Blob 的基础上扩展了用户文件系统相关的能力(原来只能在内存中操作，现在可以在本地文件系统中操作)")]),s._v(" "),a("h4",{attrs:{id:"获得-file-对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获得-file-对象"}},[s._v("#")]),s._v(" 获得 File 对象")]),s._v(" "),a("ul",[a("li",[s._v("new File")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('  const file = new File(["我是一个文本内容"], "文本.txt", {\n        type: "text/plain",\n });\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("input 文件上传")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(' input[type="file"].addEventListener("change", function (e) {\n        console.log(e.target.files);\n    });\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("e.dataTransfer 文件拖拽")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('dropContent.addEventListener("drop", function (e) {\n     e.preventDefault();\n    console.log(e.dataTransfer.files);\n  });\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"filereader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#filereader"}},[s._v("#")]),s._v(" FileReader")]),s._v(" "),a("h4",{attrs:{id:"相关概念-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关概念-3"}},[s._v("#")]),s._v(" 相关概念")]),s._v(" "),a("p",[s._v("读取 Blob 或 File 对象中的数据")]),s._v(" "),a("h4",{attrs:{id:"使用-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-2"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// 读图片\n fr.addEventListener("load", function (e) {\n   const img = new Image();\n   img.src = e.target.result;\n });\nfr.readAsDataURL(图片文件);\n\n// 读文本\n  fr.addEventListener("load", function (e) {\n     console.log(e.target.result);\n  });\n fr.readAsText(文本文件);\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"文件上传案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件上传案例"}},[s._v("#")]),s._v(" 文件上传案例")]),s._v(" "),a("p",[s._v("本案例的目标是将文件上传到内存中并在界面显示出来(不是上传到服务器)")]),s._v(" "),a("h4",{attrs:{id:"单、多文件上传"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单、多文件上传"}},[s._v("#")]),s._v(" 单、多文件上传")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('  // 点击input[type="file"]触发文件上传\n // multiple属性控制选择单个或多个文件\n <input type="file" class="file" multiple/>\n\n // 监听上传得到的文件列表(即：文件对象列表)\n fileInput.addEventListener("change", function (e) {\n    console.log(e.target.files);\n    1、文件列表存到数组里\n    2、遍历列表渲染将文件对象中的name、path、type、size等信息显示在界面上\n });\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"文件夹上传"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件夹上传"}},[s._v("#")]),s._v(" 文件夹上传")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// webkitdirectory属性让用户选择文件目录而非文件\n<input type="file" webkitdirectory class="dir" />\n\n1、监听inputchange事件，获取到选中文件夹下的文件列表\n2、渲染文件列表\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"拖拽上传"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拖拽上传"}},[s._v("#")]),s._v(" 拖拽上传")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('拖放区域监听dragover事件：\n  取消默认行为\n\n拖放区域监听drop事件：\n  1. 取消默认行为\n  2. 拿到拖拽项列表\n  3. 遍历列表，获得拖拽项在文件系统中的表示\n   for (const item of e.dataTransfer.items) {\n    console.log(item.webkitGetAsEntry());\n    getFileByEntry(item.webkitGetAsEntry());\n  }\n // 4. 判断拖拽项是不是文件\n // 如果是则加入文件列表，如果不是则递归遍历文件夹下的文件\n function getFileByEntry(entry, path = "") {\n  if (entry.isFile) {\n    // 文件\n    entry.file((file) => {\n      console.log(file);\n      file.path = `${path}${file.name}`\n      tempFileList.push(file);\n       5. 渲染文件列表\n    });\n  } else {\n    // 文件夹\n    const reader = entry.createReader();\n    reader.readEntries((entries) => {\n      for (const item of entries) {\n        getFileByEntry(item, `${path}${entry.name}/`);\n      }\n    });\n  }\n}\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("h2",{attrs:{id:"webstorageapi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webstorageapi"}},[s._v("#")]),s._v(" webStorageAPI")]),s._v(" "),a("h3",{attrs:{id:"基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本概念"}},[s._v("#")]),s._v(" 基本概念")]),s._v(" "),a("p",[s._v("包括 window.localStorage 和 window.sessionStorage")]),s._v(" "),a("p",[s._v("localStorage 是永久存储；sessionStorage 是临时存储，生命周期与页面相同")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 增，改\nstorage.setItem(key, value);\n\n// 查\nstorage.getItem(key);\n\n// 删\nstorage.removeItem(key);\nstorage.clear();\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"主题设置的案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主题设置的案例"}},[s._v("#")]),s._v(" 主题设置的案例")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("初始化时：\n 从缓存中获取主题设置，如果没有则设置为默认值\n\n切换主题时：\n 1.应用新主题\n 2.保存当前主题到缓存中\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"indexeddb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#indexeddb"}},[s._v("#")]),s._v(" indexedDB")]),s._v(" "),a("p",[s._v("用于在浏览器存储大量结构化数据(比如 file,blob 等)，区别于 storage 只能存储字符串")]),s._v(" "),a("h3",{attrs:{id:"基本概念-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本概念-2"}},[s._v("#")]),s._v(" 基本概念")]),s._v(" "),a("p",[s._v("一级：数据库\n二级：对象仓库(ObjectStore)")]),s._v(" "),a("blockquote",[a("p",[s._v("事务：对数据库的某个对象仓库的操作抽象成一个事务(即：事务关联与对象仓库)")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// 1. 链接(打开)数据库\n// 参数1表示数据库版本\nconst request = window.indexedDB.open("myDB", 1);\n\n// 2. 数据库初始化或者更新时：\nrequest.onupgradeneeded：\n   const db = e.target.result;\n   // 3. 创建对象仓库\n   const store = db.createObjectStore("user");\n   // 4. 对象仓库里加一条数据\n    store.add({ name: "张三", age: 20 }, "用户1");\n// 3. 数据库打开成功时：\nrequest.onsuccess:\n   const db = e.target.result;\n   // 2. 创建对象仓库的事务\n   const transaction = db.transaction("user", "readwrite");\n  // 3. 拿到该事务对应的对象仓库\n   const store = transaction.objectStore("user");\n  // 4. 进行增删改查操作\n  store.add({ name: "蔡徐坤", age: 30 }, "用户2");\n  store.delete("用户1");\n  store.put({ name: "马保国", age: 60 }, \'用户6\');\n  const r = store.getAll();\n  r.onsuccess = function (e) {\n     console.log(e.target.result);\n  };\n\n// 4. 数据库打开失败时：\nrequest.onerror:\n   console.log("数据库打开失败",e.target.error);\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("h3",{attrs:{id:"用户信息管理的案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户信息管理的案例"}},[s._v("#")]),s._v(" 用户信息管理的案例")]),s._v(" "),a("p",[s._v("包括：新增用户、查询用户")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1. 打开数据库\n\n2. 数据库初始化时：\n   判断如果数据库没有user对象仓库，则创建该对象仓库\n3. 数据库打开成功时：\n   给新增用用户按钮绑定事件：\n      1. 创建user对象\n      2. 创建user对象仓库的事务，并拿到该事务对应的对象仓库\n      3. user对象添加到对象仓库中\n   给查询用户按钮绑定事件：\n     1. 创建user对象仓库的事务，并拿到该事务对应的对象仓库\n     2. 查询对象仓库中所有的用户信息\n     3. 渲染用户信息到页面上\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h2",{attrs:{id:"webworkerapi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webworkerapi"}},[s._v("#")]),s._v(" webWorkerAPI")]),s._v(" "),a("h3",{attrs:{id:"基本概念-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本概念-3"}},[s._v("#")]),s._v(" 基本概念")]),s._v(" "),a("p",[s._v("单开一个线程执行脚本，一些复杂的计算任务可以由 webworker 完成，避免页面卡顿")]),s._v(" "),a("h4",{attrs:{id:"引入-webworker-的场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引入-webworker-的场景"}},[s._v("#")]),s._v(" 引入 webWorker 的场景")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// 页面一直在执行一个计时器动画控制小球来回移动\nsetInterva(() => {\n  改变小球的left值\n}, 10);\n\n// 给页面按钮绑定一个点击事件，该事件回调函数执行一个复杂的计算任务\n按钮.addEventListener("click", () => {\n  执行复杂任务\n});\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("当按钮被点击后，小球会卡住不动")]),s._v(" "),a("p",[s._v("原因分析：\n计时器每次回调任务会放到计时器队列中，当用户点击行为发生后，点击回调会发到交互队列中\n由于交互队列的优先级高于计时器队列，并且由于 js 是单线程的，主线程会选择执行交互队列中的复杂任务，导致页面卡住！")]),s._v(" "),a("p",[s._v("所以我们需要单开一个线程去完成复杂任务，webworker 就是用来解决这个问题的")]),s._v(" "),a("h4",{attrs:{id:"webworker-的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webworker-的使用"}},[s._v("#")]),s._v(" webWorker 的使用")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('主线程：\n  // 开启一个worker线程\n  // 第一个参数是worker关联的脚本\n  // 第二个参数是worker的配置项\n  // type: "module"表示脚本可以使用ES模块化\n  // name: "worker1"表示worker的名称 方便控制台调试查看\n   const worker = new Worker("./assets/mission.js", {\n        type: "module",\n        name: "worker1",\n  });\n  // 向worker线程发送消息\n  worker.postMessage(10);\n  worker.onmessage = (e) => {\n     console.log(\'收到worker的消息:\', e.data);\n  }\n\n  // 关闭worker线程\n  worker.terminate();\n\nworker脚本:\n  self.onmessage = (e) => {\n     console.log(\'收到主线程的消息:\', e.data);\n  }\n  // 给主线程发送消息\n  self.postMessage(e.data * 10);\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h3",{attrs:{id:"实现大文件上传前的分片案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现大文件上传前的分片案例"}},[s._v("#")]),s._v(" 实现大文件上传前的分片案例")]),s._v(" "),a("h4",{attrs:{id:"大文件上传的宏观思路"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#大文件上传的宏观思路"}},[s._v("#")]),s._v(" 大文件上传的宏观思路：")]),s._v(" "),a("ol",[a("li",[s._v("将大文件分割成若干个小块")]),s._v(" "),a("li",[s._v("每块计算出 hash 值")]),s._v(" "),a("li",[s._v("将 hash 值和对应的块上传到服务端")]),s._v(" "),a("li",[s._v("服务端根据这块文件重新计算出 hash 值，两个 hash 值比对，如果一致则说明上传成功(该文件没损坏、没替换)，否则失败")])]),s._v(" "),a("h4",{attrs:{id:"具体实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#具体实现"}},[s._v("#")]),s._v(" 具体实现：")]),s._v(" "),a("p",[s._v("主线程：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('拿到文件时：\n   // 算出总块数\n   const chunkTotal = Math.ceil(file.size / CHUNK_SIZE);\n   // 算出每个worker负责几个块(进行一次分组)\n   const count = Math.ceil(chunklength / MAX_WORKER);\n   // 用于存储最终分块的结果\n   // {索引：分块信息}\n   // 分块信息:{blob,hash}\n   const result = [];\n   // 开启多个worker完成各自的分块信息组装任务\n   for (let i = 0; i < MAX_WORKER; i++){\n    const worker = new Worker("./assets/fileworker.js", {\n            type: "module",\n    });\n    // 计算出当前worker负责块的索引范围(索引都是建立在file基础上的)\n     const startIndex = i * count;\n     let endIndex = startIndex + count;\n     if (endIndex > chunklength) {\n          endIndex = chunklength;\n      }\n      // 将文件、块大小、起始索引、结束索引发给worker\n      worker.postMessage([file, CHUNK_SIZE, startIndex, endIndex]);\n      // 收集来自worker的分块结果\n      worker.onmessage = function (e) {\n           // 记录有几个worker完成任务了\n            finished++;\n            // 结束当前worker的任务\n            worker.terminate();\n            // 将worker的分块结果记录到result中\n            e.data.forEach((item) => {\n              result[item.index] = item;\n            });\n            // 当所有worker的任务都完成了说明文件分片任务完成\n            if (finished === MAX_WORKER) {\n              // 处理后续上传的任务\n              console.log(result);\n            }\n          };\n   }\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])]),a("p",[s._v("worker 脚本：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 拿到主线程传过来的文件信息并开始自己的分块信息组装任务\nself.onmessage = async function(e) {\n    // 解构出文件、块大小、起始索引、结束索引\n    const [file, CHUNK_SIZE, startIndex, endIndex] = e.data;\n    // 根据索引拿到每个块信息并保存起来\n    // 块信息包括：该范围内的blob数据、对应的hash值\n    const result = [];\n    for (let i = startIndex; i < endIndex; i++) {\n      const chunk = await getChunk(file, CHUNK_SIZE, i);\n      result.push(chunk);\n    }\n    // 将组装好的分块信息发给主线程\n    self.postMessage(result);\n}\n\n\nfunction getChunk(file, size, index) {\n  return new Promise((resolve, reject) => {\n    // 根据块的长度对起始索引细化\n    const start = index * size;\n    const end = start + size;\n    // 文件切割\n    const chunkFile = file.slice(start, end);\n    // 文件转换成二进制数据并计算出hash值\n    // 然后将该块信息组装成{blob,hash}的形式返回\n    const fr = new FileReader();\n    fr.onload = function (e) {\n      const arrbuffer = e.target.result;\n      const hash = SparkMD5.ArrayBuffer.hash(arrbuffer);\n      resolve({\n        start,\n        end,\n        chunkFile,\n        index,\n        hash,\n      });\n    };\n    fr.readAsArrayBuffer(chunkFile);\n  });\n}\n\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br")])]),a("blockquote",[a("p",[s._v("[startIndex,endIndex]跨度比较大，[start, end]在前者基础上继续划分，跨度小")])]),s._v(" "),a("h4",{attrs:{id:"核心代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#核心代码"}},[s._v("#")]),s._v(" 核心代码：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const chunkFile = file.slice(start, end);\n\nfileReader.readAsArrayBuffer(chunkFile);\nfileReader.onload = function (e) {\n    const arrbuffer = e.target.result;\n    const hash = SparkMD5.ArrayBuffer.hash(arrbuffer);\n    resolve({\n      hash,\n      chunkFile\n    })\n}\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[a("img",{attrs:{src:n(440),alt:"alt text"}})]),s._v(" "),a("h2",{attrs:{id:"historyapi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#historyapi"}},[s._v("#")]),s._v(" HistoryAPI")]),s._v(" "),a("h3",{attrs:{id:"基本概念-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本概念-4"}},[s._v("#")]),s._v(" 基本概念")]),s._v(" "),a("p",[s._v("History 接口提供了浏览历史的管理功能，可以记录用户浏览过的页面，提供后退、前进等功能")]),s._v(" "),a("blockquote",[a("p",[s._v("说明：单页应用中的路由和状态管理都是基于 History API 的")])]),s._v(" "),a("p",[s._v("理解：取消了页面刷新实现内容更新的行为，通过 js 控制页面的切换，由于 HistoryAPI 记录了浏览状态，所以可以还原出之前的页面状态。")]),s._v(" "),a("h3",{attrs:{id:"好处"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#好处"}},[s._v("#")]),s._v(" 好处")]),s._v(" "),a("p",[s._v("使得页面能够实现无刷新切换内容的体验，提高用户体验，使得应用方式更像传统的桌面应用程序。")]),s._v(" "),a("h3",{attrs:{id:"案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例"}},[s._v("#")]),s._v(" 案例")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('a标签被点击：\n  1. 取消默认的链接跳转行为\n  // 2. 记录当前页面的url和其他状态\n  history.pushState({url: href}, "", href);\n  3. js渲染出新的页面内容\n\n监听浏览器前进和后退(onpopstate):\n  (e) => {\n    // 1. 获取当前页面的状态\n    const state = e.state;\n    2. 根据状态渲染出页面内容\n  }\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h2",{attrs:{id:"geolocationapi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#geolocationapi"}},[s._v("#")]),s._v(" GeolocationAPI")]),s._v(" "),a("p",[s._v("通过此 API 可以获取浏览器的当前位置信息，包括经纬度、海拔、精度、地址等。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("navigator.geolocation.getCurrentPosition((position) => {\n   const { longitude, latitude, accuracy } = position.coords;\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"字段说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字段说明"}},[s._v("#")]),s._v(" 字段说明")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("latitude（纬度）\nlongitude（经度）\naltitude（海拔高度）\naccuracy（精确性）\naltitudeAccuracy（海拔高度精确度）\nheading（方向）\nspeed（速度）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"clipboardapi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#clipboardapi"}},[s._v("#")]),s._v(" ClipboardAPI")]),s._v(" "),a("p",[s._v("提供复制、粘贴功能")]),s._v(" "),a("ul",[a("li",[s._v("监听复制事件")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("document.oncopy\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("监听粘贴事件")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("document.onpaste\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("监听剪切事件")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("document.oncut\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("向剪切板写入内容")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("navigator.clipboard.writeText(text)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("从剪切板读取内容")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("navigator.clipboard.readText().then(text => {\n  console.log(text);\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"读取剪切板中的内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#读取剪切板中的内容"}},[s._v("#")]),s._v(" 读取剪切板中的内容")]),s._v(" "),a("p",[s._v("剪切板中可以存储多种数据类型，比如文本、图片、文件等。")]),s._v(" "),a("h4",{attrs:{id:"剪切板中的数据分组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#剪切板中的数据分组"}},[s._v("#")]),s._v(" 剪切板中的数据分组")]),s._v(" "),a("p",[s._v("一级：剪切项(ClipboardItem)\n二级：数据类型(MIME type)")]),s._v(" "),a("h4",{attrs:{id:"读取-blob-中的数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#读取-blob-中的数据"}},[s._v("#")]),s._v(" 读取 blob 中的数据")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 得到剪切项数组\nconst val = await navigator.clipboard.read();\n// 拿到第一个剪切项\nconst item = val[0];\n// 遍历该剪切项中的每种类型的数据\nitem.types.forEach(type => {\n  // 拿到数据类型对应的数据\n  const blob = item.get(type);\n  fileReader读取数据\n});\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"requestanimationframe"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requestanimationframe"}},[s._v("#")]),s._v(" requestAnimationFrame")]),s._v(" "),a("p",[s._v("requestAnimationFrame 是浏览器提供的用于优化动画渲染的 API，它会在下一次重绘之前执行指定的回调函数。")]),s._v(" "),a("h3",{attrs:{id:"核心代码-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#核心代码-2"}},[s._v("#")]),s._v(" 核心代码")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("let rid;\nfunction ani() {\n  动画逻辑\n  if(满足停止条件) {\n    cancelAnimationFrame(rid);\n  }\n  // 反复执行动画逻辑\n  rid = requestAnimationFrame(ani);\n}\n\n// 开始动画\nrid = requestAnimationFrame(ani);\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("blockquote",[a("p",[s._v("说明：requestAnimationFrame() 是一次性的，如果希望下一次继续执行动画，需要再次调用 requestAnimationFrame() 函数。")])]),s._v(" "),a("h2",{attrs:{id:"webanimationapi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webanimationapi"}},[s._v("#")]),s._v(" webAnimationAPI")]),s._v(" "),a("p",[s._v("依靠 js 的逻辑灵活性，可以实现复杂的动画效果。")]),s._v(" "),a("h3",{attrs:{id:"创建动画"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建动画"}},[s._v("#")]),s._v(" 创建动画")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Element.animate([关键帧],配置对象)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("关键帧类似于 css3 @keyframes 定义的每一帧的样式状态")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('关键帧：{\n  css属性,\n  offset(取值0-1，表示关键帧的位置)\n}\n\n配置对象：{\n  duration,\n  easing,// 缓动函数，定义动画的速度曲线可以是一个字符串，如 "linear"、"ease-in"、"ease-out" 等，也可以是自定义的 cubic-bezier 函数。不同的缓动函数会导致不同的动画效果，从线性过渡到弹簧效果等\n  delay,\n  iterations,// 动画的迭代次数，可以是无限次，也可以是具体的次数\n  direction,// 动画的方向，可以是 "normal"（正向播放）、"reverse"（反向播放）、"alternate"（正向反向交替播放）或"alternate-reverse"（反向正向交替播放）。这决定了动画是正向还是反向播放，以及是否交替播放\n  fill, // 动画结束后是否保持最终状态。可以是 "none"（不保持）、"forwards"（保持最终状态）、"backwards"（保持初始状态）或"both"（同时保持初始和最终状态）。这个属性控制动画结束后元素的状态。\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"控制动画"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#控制动画"}},[s._v("#")]),s._v(" 控制动画")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("animation.play(): 开始或继续动画。\nanimation.pause(): 暂停动画。\nanimation.cancel(): 取消动画。\nanimation.finish(): 立即完成动画。\nanimation.reverse(): 反向播放动画。\nanimation.currentTime: 获取或设置动画的当前时间\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"动画事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动画事件"}},[s._v("#")]),s._v(" 动画事件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("animation.onfinish: 在动画完成时触发。\nanimation.oncancel: 在取消动画时触发。\nanimation.onremove: 在动画被移除时触发。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"文字雨的案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文字雨的案例"}},[s._v("#")]),s._v(" 文字雨的案例")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('function rain() {\n// 1. 创建一个文字元素\nconst textElem = document.createElement("span");\ntextElem.innerText = getRandomText();\ntextElem.className = "text";\n// 2. 设置文字初始水平偏移位置\nconst dx = getRandom(0, 310);\n// 3. 执行下落动画\n// 下落后停留一会\nconst animate = textElem.animate(\n    [\n      { transform: `translateX(${dx}px)`, offset: 0 },\n      { transform: `translate(${dx}px, 290px)`, offset: 0.7 },\n      { transform: `translate(${dx}px, 290px)`, offset: 1 },\n    ],\n    {\n      duration: getRandom(1600, 3000),\n      easing: "linear",\n      fill: "forwards",\n    }\n  );\n// 4. 动画完成后移除文字元素\n  animate.onfinish = function () {\n    textEle.remove();\n  };\n\n // 反复执行动画\nrequestAnimationFrame(rain);\n}\n\nrequestAnimationFrame(rain);\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("h2",{attrs:{id:"intersectionobserver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#intersectionobserver"}},[s._v("#")]),s._v(" IntersectionObserver")]),s._v(" "),a("p",[s._v("交叉观察者，观察者与被观察者之间的交叉状态发生变化时，会触发回调函数。")]),s._v(" "),a("h3",{attrs:{id:"基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本使用"}},[s._v("#")]),s._v(" 基本使用")]),s._v(" "),a("p",[s._v("页面上有一个父元素：container\n里面有一个子元素：target")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// 定义观察者\nconst observer = new IntersectionObserver(entries => {\n  // 遍历所有被观察者元素\n  // 如果满足交叉条件，则停止观察该元素\n  entries.forEach((entry) => {\n    if (entry.isIntersecting) {\n      ob.unobserve(entry.target);\n      console.log("满足交叉条件");\n      } else {\n       console.log("不满足交叉条件");\n      }\n   });\n},{\n  root: container, // 观察者是哪个元素，默认是视口\n  rootMargin: \'0px\', // 观察者的边界范围\n  threshold: 0.1 // 观察者的阈值，0表示只要一接触就触发，1表示完全进入才触发\n})\n\n// 开始观察\nobserver.observe(target);\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h3",{attrs:{id:"图片懒加载的案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图片懒加载的案例"}},[s._v("#")]),s._v(" 图片懒加载的案例")]),s._v(" "),a("ol",[a("li",[s._v("默认将img的src属性设置为一张占位图，真正的图片资源放到data-src属性中")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('    <img\n      src="./default.png"\n      data-src="https://picsum.photos/400/600?r=1"\n    />\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("观察页面中所有的img元素")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const ob = new IntersectionObserver();\nconst imgs = document.querySelectorAll('img[data-src]');\nob.observe(imgs);\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("如果被观察的img进入视口了，则将data-src属性的值赋值给src属性，并取消对该img的观察")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("回调：\n(entries) => {\n    entries.forEach((entry) => {\n      if (entry.isIntersecting) {\n        const img = entry.target;\n        img.src = img.dataset.src;\n        ob.unobserve(img);\n      }\n    });\n}\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"mutationobserver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mutationobserver"}},[s._v("#")]),s._v(" MutationObserver")]),s._v(" "),a("p",[s._v("监听Dom树变化的观察者")]),s._v(" "),a("h3",{attrs:{id:"基本使用-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本使用-2"}},[s._v("#")]),s._v(" 基本使用")]),s._v(" "),a("ol",[a("li",[s._v("定义观察者")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const observer = new MutationObserver(回调)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("观察目标元素")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("observer.observe(目标元素, 配置对象)\n\n配置对象：{\n attributes: true, // Boolean - 观察目标属性的改变\n characterData: true, // Boolean - 观察目标数据的改变(改变前的数据/值)\n childList: true, // Boolean - 观察目标子节点的变化，比如添加或者删除目标子节点，不包括修改子节点以及子节点后代的变化\n subtree: true, // Boolean - 目标以及目标的后代改变都会观察\n attributeOldValue: true, // Boolean - 表示需要记录改变前的目标属性值\n characterDataOldValue: true, // Boolean - 设置了characterDataOldValue可以省略characterData设置\n attributeFilter: ['src', 'class'] // Array - 观察指定属性\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"表格商品总价汇总的案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#表格商品总价汇总的案例"}},[s._v("#")]),s._v(" 表格商品总价汇总的案例")]),s._v(" "),a("p",[s._v("表格中有商品数量、单价、总价三列，需要实时计算总价。")]),s._v(" "),a("ol",[a("li",[s._v("定义观察者，观察表格的子元素数据内容的变化")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const observer = new MutationObserver(回调)\nobserver.observe(table, {\n  subtree: true,\n  characterData: true\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("表格数据一旦发生变化，则在回调中计算总价")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("回调：\n(mutation) => {\n  // 1.拿到目标元素\n  const target = mutation.target;\n  2.拿到目标元素子单元格中的单价、数量\n  3. 计算总价并渲染到总价单元格中\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);