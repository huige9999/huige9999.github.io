(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{514:function(a,s,e){"use strict";e.r(s);var t=e(2),n=Object(t.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"清空输出目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#清空输出目录"}},[a._v("#")]),a._v(" 清空输出目录")]),a._v(" "),s("p",[a._v("clean-webpack-plugin")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n\nplugins: [\n    new CleanWebpackPlugin()\n]\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h3",{attrs:{id:"原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[a._v("#")]),a._v(" 原理")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("当emit时(生成资源到文件列表之前)：\n    用fs模块删除dist目录\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h2",{attrs:{id:"自动生成页面"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动生成页面"}},[a._v("#")]),a._v(" 自动生成页面")]),a._v(" "),s("p",[a._v("html-webpack-plugin")]),a._v(" "),s("p",[a._v("自动生成html，引入打包生成的js文件")]),a._v(" "),s("h3",{attrs:{id:"原理-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原理-2"}},[a._v("#")]),a._v(" 原理")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("当emit时：\n    1. 利用fs模块生成一个页面文件\n    2. 给文件内容的合适位置添加一个script元素，元素的src路径引用打包后的js\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h3",{attrs:{id:"页面按照给定的模板生成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#页面按照给定的模板生成"}},[a._v("#")]),a._v(" 页面按照给定的模板生成")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("new HtmlWebpackPlugin({\n    template: './public/index.html',\n})\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("blockquote",[s("p",[a._v("多入口情况下(即生成多个bundle的情况下)，生成的html会将所有bundle引入")]),a._v(" "),s("blockquote",[s("p",[a._v("使用配置 chunks: all默认所有，chunks: ['home'] 只会引入home bundle")])])]),a._v(" "),s("p",[s("strong",[a._v("一次new HtmlWebpackPlugin()只能生成一个页面，如果需要生成多个页面，需要多个HtmlWebpackPlugin()")])]),a._v(" "),s("h2",{attrs:{id:"复制静态资源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#复制静态资源"}},[a._v("#")]),a._v(" 复制静态资源")]),a._v(" "),s("p",[a._v("copy-webpack-plugin")]),a._v(" "),s("h3",{attrs:{id:"场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#场景"}},[a._v("#")]),a._v(" 场景")]),a._v(" "),s("p",[a._v("将public目录下的资源原封不动的输出到打包目录下\n即：页面中与模块依赖无关的纯静态资源")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("new copyPlugin([\n    {\n      from : './public',\n      to : './'\n    } // 复制规则\n])\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h2",{attrs:{id:"开发服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开发服务器"}},[a._v("#")]),a._v(" 开发服务器")]),a._v(" "),s("h3",{attrs:{id:"为什么需要开发服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要开发服务器"}},[a._v("#")]),a._v(" 为什么需要开发服务器？")]),a._v(" "),s("ul",[s("li",[a._v("开发阶段的打包、运行、调试过程比较繁琐")]),a._v(" "),s("li",[a._v("我们往往希望最终生成的代码和页面部署到服务器上,来模拟真实环境")])]),a._v(" "),s("p",[a._v("为了解决这些问题，webpack官方制作了一个单独的库："),s("strong",[a._v("webpack-dev-server")]),a._v("\n它"),s("strong",[a._v("既不是plugin也不是loader")])]),a._v(" "),s("h3",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[a._v("#")]),a._v(" 使用")]),a._v(" "),s("ol",[s("li",[a._v("安装")]),a._v(" "),s("li",[a._v("执行"),s("code",[a._v("webpack-dev-server")]),a._v("命令")])]),a._v(" "),s("p",[s("code",[a._v("webpack-dev-server")]),a._v("命令几乎支持所有的webpack命令参数，如"),s("code",[a._v("--config")]),a._v("、"),s("code",[a._v("-env")]),a._v("等等，你可以把它当作webpack命令使用")]),a._v(" "),s("p",[a._v("这个命令是专门为开发阶段服务的，真正部署的时候还是得使用webpack命令")]),a._v(" "),s("h3",{attrs:{id:"原理-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原理-3"}},[a._v("#")]),a._v(" 原理")]),a._v(" "),s("p",[a._v("当我们执行"),s("code",[a._v("webpack-dev-server")]),a._v("命令后，它做了以下操作：")]),a._v(" "),s("ol",[s("li",[a._v("内部执行webpack命令，传递命令参数")]),a._v(" "),s("li",[a._v("开启watch")]),a._v(" "),s("li",[a._v("注册hooks：类似于plugin，webpack-dev-server会向webpack中注册一些钩子函数，主要功能如下：\n"),s("ol",[s("li",[a._v("将资源列表（aseets）保存起来")]),a._v(" "),s("li",[a._v("禁止webpack输出文件")])])]),a._v(" "),s("li",[a._v("用express开启一个服务器，监听某个端口，当请求到达后，根据请求的路径，给予相应的资源内容")])]),a._v(" "),s("h3",{attrs:{id:"配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[a._v("#")]),a._v(" 配置")]),a._v(" "),s("p",[a._v("针对webpack-dev-server的配置，参考：https://www.webpackjs.com/configuration/dev-server/")]),a._v(" "),s("p",[a._v("常见配置有：")]),a._v(" "),s("ul",[s("li",[a._v("port：配置监听端口")]),a._v(" "),s("li",[a._v("proxy：配置代理，常用于跨域访问")]),a._v(" "),s("li",[a._v("stats：配置控制台输出内容")])]),a._v(" "),s("h2",{attrs:{id:"普通文件处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#普通文件处理"}},[a._v("#")]),a._v(" 普通文件处理")]),a._v(" "),s("h3",{attrs:{id:"file-loader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#file-loader"}},[a._v("#")]),a._v(" file-loader")]),a._v(" "),s("p",[a._v("生成依赖的文件到输出目录，然后将模块文件设置为：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("module.exports = 文件路径\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"原理-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原理-4"}},[a._v("#")]),a._v(" 原理")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('// source: 文件内容(buffer)\nfunction fileLoader(source) {\n 1. 生成一个具有相同文件内容的文件到输出目录\n 2. 返回一段代码："export default 文件名"\n}\n\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h3",{attrs:{id:"url-loader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#url-loader"}},[a._v("#")]),a._v(" url-loader")]),a._v(" "),s("p",[a._v("将依赖的文件转换为: 导出一个base64格式的字符串")]),a._v(" "),s("h3",{attrs:{id:"原理-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原理-5"}},[a._v("#")]),a._v(" 原理")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('function urlLoader(source) {\n  1. 根据buffer生成一个base64字符串\n  2. 返回一段代码："export default base64字符串"\n}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h3",{attrs:{id:"url-loader和file-loader联用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#url-loader和file-loader联用"}},[a._v("#")]),a._v(" url-loader和file-loader联用")]),a._v(" "),s("p",[a._v("url-loader可以配置limit，当文件大小小于limit时，会将文件转换为base64字符串，否则会使用file-loader生成文件")]),a._v(" "),s("h2",{attrs:{id:"解决路径问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决路径问题"}},[a._v("#")]),a._v(" 解决路径问题")]),a._v(" "),s("h3",{attrs:{id:"问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[a._v("#")]),a._v(" 问题")]),a._v(" "),s("p",[a._v("在使用file-loader或url-loader时，可能会遇到一个非常有趣的问题")]),a._v(" "),s("p",[a._v("比如，通过webpack打包的目录结构如下：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('dist\n    |—— img\n        |—— a.png  #file-loader生成的文件\n    |—— scripts\n        |—— main.js  #export default "img/a.png"\n    |—— html\n        |—— index.html #<script src="../scripts/main.js" ><\/script>\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h3",{attrs:{id:"产生问题的原因"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#产生问题的原因"}},[a._v("#")]),a._v(" 产生问题的原因")]),a._v(" "),s("p",[a._v("这种问题发生的根本原因：模块中的路径来自于某个loader或plugin，\n当产生路径时，loader或plugin只知道相对于dist目录的路径，并不知道该路径将在哪个资源中使用，从而无法确定最终正确的路径")]),a._v(" "),s("blockquote",[s("p",[a._v("比如file-loader转换图片的时候会生成一个文件到输出目录(即dist目录下)、并export default 该地址")])]),a._v(" "),s("p",[a._v("面对这种情况，需要依靠webpack的配置publicPath解决")]),a._v(" "),s("h3",{attrs:{id:"publicpath本质"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#publicpath本质"}},[a._v("#")]),a._v(" publicPath本质")]),a._v(" "),s("p",[a._v("本质就是webpack定义的一个字符串")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('_webpack_require_.p = "???"\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("有些插件和loader会使用这个字符串，来生成正确的路径")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("if(_webpack_require_.p) {\n  // 生成的路径 = _webpack_require_.p + 模块路径\n} else {\n  // 生成的路径 = 模块路径\n}\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h3",{attrs:{id:"理解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#理解"}},[a._v("#")]),a._v(" 理解")]),a._v(" "),s("p",[a._v("定义的时候只能参照dist目录，不知道使用时候的具体情况,所以需要定义第三方publicPath变量来协调")]),a._v(" "),s("h2",{attrs:{id:"webpack内置插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webpack内置插件"}},[a._v("#")]),a._v(" webpack内置插件")]),a._v(" "),s("p",[a._v("所有的webpack内置插件都作为webpack的静态属性存在的，使用下面的方式即可创建一个插件对象")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('const webpack = require("webpack")\n\nnew webpack.插件名(options)\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h3",{attrs:{id:"defineplugin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#defineplugin"}},[a._v("#")]),a._v(" DefinePlugin")]),a._v(" "),s("p",[a._v("全局常量定义插件，使用该插件通常定义一些常量值，例如:")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('new webpack.DefinePlugin({\n    PI: `Math.PI`, // PI = Math.PI\n    VERSION: `"1.0.0"`, // VERSION = "1.0.0"\n    DOMAIN: JSON.stringify("duyi.com")\n})\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("这样一来，在源码中，我们可以直接使用插件中提供的常量，当webpack编译完成后，会自动替换为常量的值")]),a._v(" "),s("h3",{attrs:{id:"bannerplugin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bannerplugin"}},[a._v("#")]),a._v(" BannerPlugin")]),a._v(" "),s("p",[a._v("它可以为每个chunk生成的文件头部添加一行注释，一般用于添加作者、公司、版权等信息")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("new webpack.BannerPlugin({\n  banner: `\n  hash:[hash]\n  chunkhash:[chunkhash]\n  name:[name]\n  author:yuanjin\n  corporation:duyi\n  `\n})\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("h3",{attrs:{id:"provideplugin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#provideplugin"}},[a._v("#")]),a._v(" ProvidePlugin")]),a._v(" "),s("p",[a._v("自动加载模块，而不必到处 import 或 require")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("new webpack.ProvidePlugin({\n  $: 'jquery',\n  _: 'lodash'\n})\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("然后在我们任意源码中：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("$('#item'); // <= 起作用\n_.drop([1, 2, 3], 2); // <= 起作用\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);